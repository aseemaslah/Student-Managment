<div class="layout">

  <!-- Sidebar -->
  <div class="sidebar">
    <app-teachersidebar></app-teachersidebar>
  </div>

  <!-- Main -->
  <div class="main-content">

    <div class="top-bar mb-3">
      <div class="title">
        <h3>Attendance Sheet</h3>
        <p>Mark monthly attendance</p>
      </div>
    </div>

    <div class="card p-4 border-0 rounded-4 shadow-sm">

      <!-- Month Selector -->
      <div class="row mb-3">
        <div class="col-md-4 col-12">
          <label class="form-label">Select Month</label>
          <input type="month" class="form-control" [(ngModel)]="selectedMonth" (change)="generateDates()" />
        </div>
      </div>

      <!-- Loading -->
      @if (loading) {
      <div class="text-center p-5">
        <div class="spinner-border text-primary"></div>
        <p class="mt-2 text-muted">Processing students...</p>
      </div>
      }

      <!-- Table -->
      @else if (selectedMonth && monthDates.length > 0) {
      <div class="table-responsive attendance-table">
        <table class="table table-bordered table-hover text-center align-middle">

          <thead class="table-dark">
            <tr>
              <th class="sticky-col">Student Name</th>
              @for (date of monthDates; track date) {
              <th>
                <small>{{ date | date:'EEE' }}</small><br>
                {{ date | date:'dd' }}
              </th>
              }
            </tr>
          </thead>

          <tbody>
            @for (student of students; track student._id) {
            <tr>
              <td class="sticky-col fw-semibold text-start">
                {{ student.userId?.username }}
              </td>

              @for (date of monthDates; track date) {
              <td>
                <input type="checkbox" class="form-check-input" [(ngModel)]="attendance[student._id][date]"
                  name="{{ student._id + date }}" />
              </td>
              }
            </tr>
            }
          </tbody>

        </table>
      </div>

      <!-- Save Button -->
      <div class="text-end mt-4 save-area">
        <button class="btn btn-primary px-4 py-2 fw-bold shadow-sm" (click)="saveAttendance()" [disabled]="loading">
          <i class="fas fa-save me-2"></i>
          {{ loading ? 'Saving...' : 'Save Attendance' }}
        </button>
      </div>
      }

      <!-- Empty States -->
      @else if (selectedMonth) {
      <div class="alert alert-info mt-3">
        Initializing attendance sheet for the selected month...
      </div>
      }

      @else {
      <div class="text-center p-5 text-muted">
        <i class="fas fa-calendar-alt fa-3x mb-3 opacity-25"></i>
        <p>Please select a month to mark attendance</p>
      </div>
      }

    </div>
  </div>
</div>;,